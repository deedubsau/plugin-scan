class ExploitabilityController < ApplicationController
  before_filter :authenticate_user!

  def index
    @flash_data = get_stats("ao_flash","Adobe Flash","11,3,300,262")
    @java_data = get_stats("ao_java","Java","1,7,0,5")
    @quicktime_data = get_stats("ao_qt","Quicktime","7,7,2,0")
    @reader_data = get_stats("ao_reader","Adobe Reader","10,1,3,0")
    @silver_data = get_stats("ao_silver","Silverlight","5,1,10411,0")
  end

  private

  def get_stats(software,software_name,current)
    up_to_date = Hit.where("#{software}".intern => "#{current}").count
    none = Hit.where("#{software}".intern => nil).count
    exploitable = Hit.count - ( up_to_date + none ) 
    data = "\t  \[\'Exploitable\', #{exploitable}\],\n"
    data += "\t  \[\'Current #{software_name} #{current.gsub("\,","\.")}\', #{up_to_date}\],\n"
    data += "\t  \[\'Not Detected\', #{none}\]\n"
  end

end
